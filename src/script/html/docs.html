<!--
SPDX-FileCopyrightText: Stone Tickle <lattis@mochiro.moe>
SPDX-License-Identifier: GPL-3.0-only
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NTUuMzYiIGhlaWdodD0iNjU1LjM2IiB2aWV3Qm94PSIwIDAgNDkxLjUyIDQ5MS41MiI+PHBhdGggZmlsbD0iIzQ5YmY2NiIgZmlsbC1ydWxlPSJldmVub2RkIiBkPSJtNDg4LjA1NyAzLjY0Mi0uNzk3IDIxLjk2Mi0uNzgzIDIxLjI2Ni0uNzgxIDIwLjU4LS43OSAxOS45MDctLjgxIDE5LjI0NS0uODQ0IDE4LjU5NC0uODg3IDE3Ljk1Ni0uOTQ0IDE3LjMyOS0xLjAxIDE2LjcxMy0xLjA5IDE2LjEwOS0xLjE4IDE1LjUxNy0xLjI4MyAxNC45MzctMS4zOTYgMTQuMzY4LTEuNTIyIDEzLjgxLTEuNjU5IDEzLjI2NS0xLjgwNyAxMi43MzEtMS45NjggMTIuMjA4LTIuMTQgMTEuNjk4LTIuMzIzIDExLjE5OC0yLjUxOSAxMC43MTEtMi43MjUgMTAuMjM1LTIuOTQ0IDkuNzcxLTMuMTczIDkuMzE4LTMuNDE2IDguODc3LTMuNjY4IDguNDQ4LTMuOTM0IDguMDMtNC4yMSA3LjYyNC00LjQ5OCA3LjIzLTQuNzk3IDYuODQ3LTUuMTEgNi40NzUtNS40MzIgNi4xMTYtNS43NjYgNS43NjgtNi4xMTMgNS40MzItNi40NzEgNS4xMDctNi44NCA0Ljc5NC03LjIyMSA0LjQ5Mi03LjYxNCA0LjIwMy04LjAxOCAzLjkyNC04LjQzNCAzLjY1OC04Ljg2MSAzLjQwMy05LjMwMSAzLjE2LTkuNzUxIDIuOTI5LTEwLjIxNCAyLjcwOC0xMC42ODcgMi41LTExLjE3NCAyLjMwMy0xMS42NyAyLjExOC0xMi4xNzkgMS45NDQtMTIuNyAxLjc4My0xMy4yMzIgMS42MzItMTMuNzc1IDEuNDk0LTE0LjMzMSAxLjM2Ny0xNC44OTggMS4yNTEtMTUuNDc2IDEuMTQ4LTE2LjA2NyAxLjA1Ni0xNi42NjguOTc1LTE3LjI4MS45MDYtMTcuOTA3Ljg0OS0xOC41NDMuODA0LTE5LjE5Mi43Ny0xOS44NTEuNzQ3LTIwLjUyMy43MzctMjEuMjA2LjczOC0yMS45Ljc1LjY5Mi0yMS45NjcuNjg2LTIxLjI3LjY5LTIwLjU4NS43MDUtMTkuOTEyLjczMy0xOS4yNS43NzItMTguNi44MjItMTcuOTYxLjg4NC0xNy4zMzQuOTU3LTE2LjcxOSAxLjA0LTE2LjExNSAxLjEzOC0xNS41MjMgMS4yNDUtMTQuOTQyIDEuMzYzLTE0LjM3MyAxLjQ5NC0xMy44MTYgMS42MzYtMTMuMjcxIDEuNzg4LTEyLjczNiAxLjk1NC0xMi4yMTQgMi4xMy0xMS43MDMgMi4zMTYtMTEuMjAzIDIuNTE2LTEwLjcxNiAyLjcyNi0xMC4yNDEgMi45NDgtOS43NzUgMy4xODItOS4zMjMgMy40MjYtOC44ODIgMy42ODItOC40NTIgMy45NS04LjAzNCA0LjIyOS03LjYyOCA0LjUxOS03LjIzNCA0LjgyMS02Ljg1IDUuMTM1LTYuNDc4IDUuNDYtNi4xMiA1Ljc5NS01Ljc3IDYuMTQzLTUuNDM0IDYuNTAzLTUuMTA5IDYuODczLTQuNzk1IDcuMjU1LTQuNDk0IDcuNjQ5LTQuMjAzIDguMDUzLTMuOTI1IDguNDctMy42NTkgOC44OTctMy40MDIgOS4zMzctMy4xNiA5Ljc4OC0yLjkyNiAxMC4yNDktMi43MDcgMTAuNzIzLTIuNDk3IDExLjIwOC0yLjMgMTEuNzA1LTIuMTE1IDEyLjIxMi0xLjk0MSAxMi43MzItMS43NzggMTMuMjYyLTEuNjI4IDEzLjgwNS0xLjQ4OCAxNC4zNTgtMS4zNiAxNC45MjQtMS4yNDUgMTUuNDk5LTEuMTQxIDE2LjA4OC0xLjA0OCAxNi42ODgtLjk2NiAxNy4yOTgtLjg5NyAxNy45Mi0uODQgMTguNTU0LS43OTMgMTkuMTk5LS43NTggMTkuODU2LS43MzUgMjAuNTI0LS43MjQgMjEuMjA0LS43MjQgMjEuODk0LS43MzZNOTMuNTQzIDEwOC41NzlsOC4wMzgtNi4zMzkgOC4yNTktNS4xNjUgOC40Ni00LjAzNyA4LjYzOC0yLjk1NCA4Ljc5NS0xLjkxNSA4LjkzMS0uOTIgOS4wNDYuMDI3IDkuMTM4LjkzMiA5LjIxIDEuNzkgOS4yNiAyLjYwNiA5LjI4OCAzLjM3NSA5LjI5NiA0LjA5OSA5LjI4MSA0Ljc3OSA5LjI0NSA1LjQxNCA5LjE4OCA2LjAwNCA5LjExIDYuNTUgOS4wMDkgNy4wNDkgOC44ODggNy41MDUgOC43NDUgNy45MTUgOC41OCA4LjI4MSA4LjM5NCA4LjYwMiA4LjE4NyA4Ljg3OCA3Ljk1OCA5LjEwOSA3LjcwOCA5LjI5NSA3LjQzNiA5LjQzNyA3LjE0MyA5LjUzMyA2LjgyOCA5LjU4NSA2LjQ5MiA5LjU5MSA2LjEzNSA5LjU1NCA1Ljc1NiA5LjQ3IDEuNjUyIDIuODgzLjg1NC0yLjU2MSAxLjA3My0zLjQ0OSAxLjAzNi0zLjU1OS45OTktMy42NTkuOTY0LTMuNzQ4LjkyOC0zLjgyOS44OTMtMy44OTcuODU5LTMuOTU3LjgyNC00LjAwNy43OTEtNC4wNDUuNzU4LTQuMDc0LjcyNS00LjA5My42OTQtNC4xMDEuNjYxLTQuMS42My00LjA4OC42LTQuMDY2LjU2OS00LjAzMy41NC0zLjk5Mi41MS0zLjkzOS40ODEtMy44NzYuNDUzLTMuODA0LjQyNS0zLjcyMS4zOTctMy42MjguMzctMy41MjQuMzQ0LTMuNDEyLjMxOC0zLjI4Ny4yOTItMy4xNTQuMjY3LTMuMDEuMjQzLTIuODU2LjIxOC0yLjY5Mi4xOTUtMi41MTguMTcxLTIuMzMzLjE0OC0yLjEzOC4xMjctMS45MzQuMTA0LTEuNzE4LjA4My0xLjQ5NC4wNjItMS4yNTguMDQyLTEuMDEzLjAyMS0uNzU3LjAwMi0uNDkyLS4wMTYtLjIxNS4wNi4xNDEuMTkuNDUuMzEzLjc1Mi40MzIgMS4wNDMuNTQ0IDEuMzI2LjY1MSAxLjYwMS43NTIgMS44NjUuODQ3IDIuMTIyLjkzNyAyLjM2OSAxLjAyMiAyLjYwOCAxLjEgMi44MzcgMS4xNzMgMy4wNTcgMS4yNDEgMy4yNjkgMS4zMDIgMy40NzIgMS4zNTkgMy42NjUgMS40MDggMy44NSAxLjQ1NCA0LjAyNyAxLjQ5MyA0LjE5MyAxLjUyNiA0LjM1MSAxLjU1NSA0LjUgMS41NzYgNC42NDEgMS41OTQgNC43NzIgMS42MDQgNC44OTQgMS42MSA1LjAwNyAxLjYwOSA1LjExMyAxLjYwNCA1LjIwNyAxLjU5MiA1LjI5NSAxLjU3NSA1LjM3MiAxLjU1MiA1LjQ0MSAxLjUyNCA1LjUwMSAxLjQ5IDUuNTUxIDEuNDUgNS41OTQgMS40MDUgNS42MjcgMS4zNTMgNS42NTEgMS4yOTggNS42NjcgMS4yMzUgNS42NzMgMS4xNjcgNS42NyAxLjA5NCA1LjY1OCAxLjAxNSA1LjYzOS45MyA1LjYwOS44MzkgNS41Ny43NDQgNS41MjQuNjQyIDUuNDY3LjUzNSA1LjQwMi40MjEgNS4zMjkuMzA0IDUuMjQ1LjE3OSA1LjE1NC4wNDkgNS4wNTMtLjA4NiA0Ljk0My0uMjI3IDQuODI1LS4zNzQgNC42OTctLjUyNiA0LjU2LS42ODQgNC40MTYtLjg0OCA0LjI2MS0xLjAxNiA0LjA5OC0xLjE5MiAzLjkyNS0xLjM3MiAzLjc0NS0xLjU1OSAzLjU1NS0xLjc1IDMuMzU2LTEuOTQ3IDMuMTQ4LTIuMTUxIDIuOTMxLTIuMzU5IDIuNzA1LTIuNTczIDIuNDcxLTguMDM4IDYuMzM5LTguMjU5IDUuMTY1LTguNDYgNC4wMzctOC42MzggMi45NTQtOC43OTUgMS45MTUtOC45MzEuOTIxLTkuMDQ2LS4wMjgtOS4xMzgtLjkzMi05LjIxLTEuNzkxLTkuMjYtMi42MDUtOS4yODgtMy4zNzUtOS4yOTYtNC4wOTktOS4yODEtNC43NzktOS4yNDUtNS40MTQtOS4xODgtNi4wMDQtOS4xMS02LjU1LTkuMDA5LTcuMDQ5LTguODg4LTcuNTA1LTguNzQ0LTcuOTE1LTguNTgxLTguMjgxLTguMzk0LTguNjAyLTguMTg3LTguODc4LTcuOTU4LTkuMTA5LTcuNzA4LTkuMjk1LTcuNDM2LTkuNDM3LTcuMTQzLTkuNTMzLTYuODI4LTkuNTg1LTYuNDkyLTkuNTkxLTYuMTM1LTkuNTU0LTUuNzU2LTkuNDctMS42NTItMi44ODMtLjg1NCAyLjU2MS0xLjA3MyAzLjQ0OS0xLjAzNiAzLjU1OS0uOTk5IDMuNjU4LS45NjQgMy43NDktLjkyOCAzLjgyOC0uODkzIDMuODk4LS44NTggMy45NTctLjgyNSA0LjAwNy0uNzkxIDQuMDQ1LS43NTggNC4wNzQtLjcyNSA0LjA5My0uNjk0IDQuMTAxLS42NjEgNC4xLS42MyA0LjA4Ny0uNiA0LjA2Ni0uNTY5IDQuMDM0LS41NCAzLjk5Mi0uNTEgMy45MzktLjQ4MSAzLjg3Ni0uNDUzIDMuODA0LS40MjQgMy43MjEtLjM5OCAzLjYyOC0uMzcgMy41MjQtLjM0NCAzLjQxMS0uMzE4IDMuMjg4LS4yOTIgMy4xNTQtLjI2NyAzLjAxLS4yNDMgMi44NTYtLjIxOCAyLjY5Mi0uMTk1IDIuNTE4LS4xNzEgMi4zMzMtLjE0OCAyLjEzOC0uMTI3IDEuOTM0LS4xMDQgMS43MTgtLjA4MyAxLjQ5NC0uMDYyIDEuMjU4LS4wNDIgMS4wMTMtLjAyMS43NTctLjAwMi40OTIuMDE2LjIxNS0uMDYtLjE0MS0uMTktLjQ1LS4zMTMtLjc1Mi0uNDMyLTEuMDQzLS41NDQtMS4zMjYtLjY1MS0xLjYwMS0uNzUyLTEuODY1LS44NDctMi4xMjItLjkzOC0yLjM2OS0xLjAyMS0yLjYwOC0xLjEtMi44MzYtMS4xNzQtMy4wNTgtMS4yNC0zLjI2OS0xLjMwMi0zLjQ3MS0xLjM1OS0zLjY2Ni0xLjQwOS0zLjg1LTEuNDUzLTQuMDI2LTEuNDkzLTQuMTkzLTEuNTI3LTQuMzUyLTEuNTU0LTQuNS0xLjU3Ni00LjY0LTEuNTk0LTQuNzcyLTEuNjA0LTQuODk0LTEuNjEtNS4wMDgtMS42MS01LjExMi0xLjYwMy01LjIwOC0xLjU5Mi01LjI5NC0xLjU3NS01LjM3Mi0xLjU1Mi01LjQ0MS0xLjUyNC01LjUwMS0xLjQ5LTUuNTUyLTEuNDUtNS41OTQtMS40MDUtNS42MjctMS4zNTMtNS42NTEtMS4yOTgtNS42NjYtMS4yMzUtNS42NzMtMS4xNjctNS42Ny0xLjA5NC01LjY1OS0xLjAxNS01LjYzOS0uOTMtNS42MDgtLjg0LTUuNTcxLS43NDMtNS41MjQtLjY0Mi01LjQ2Ny0uNTM1LTUuNDAyLS40MjEtNS4zMjktLjMwNC01LjI0NS0uMTc5LTUuMTU0LS4wNS01LjA1My4wODctNC45NDMuMjI3LTQuODI1LjM3NC00LjY5Ny41MjYtNC41Ni42ODQtNC40MTYuODQ4LTQuMjYxIDEuMDE2LTQuMDk4IDEuMTkyLTMuOTI1IDEuMzcyLTMuNzQ1IDEuNTU5LTMuNTU1IDEuNzUtMy4zNTYgMS45NDctMy4xNDggMi4xNS0yLjkzMSAyLjM2LTIuNzA1IDIuNTczLTIuNDcxIi8+PC9zdmc+'>
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: none;
        padding: 0;
        padding-top: 0;
        font-family: sans-serif;
        background-color: #282A36;
        color: #F8F8F2;
      }

      a {
        color: #8BE9FD;
      }

      a:hover {
        color: #F8F8F2;
        background-color: #FFB86C;
      }

      button {
        border-radius: 0.1875rem;
        box-shadow: 0 0.125rem 5px rgba(0, 0, 0, 0.2);
        box-sizing: border-box;
        color: #BD93F9;
        background-color: #21222C;
        cursor: pointer;
        display: inline-flex;
        height: 1.75rem;
        padding: 0 0.625rem;
        justify-content: center;
        min-width: 4.063rem;
        text-decoration: none;
        align-items: center;
        border: 0.0625rem solid #6272A4;
      }

      p {
        margin: 0;
      }

      .wrapper {
        padding: 10px;
        width: 80%%;
      }

      .elements {
        display: flex;
        flex-direction: column;
      }

      @media screen and (max-width: 500px) {
        .wrapper {
          width: 100%%;
        }
      }

      ul.columns {
        column-width: 20em;
        list-style-type: '';
      }

      #sectNav {
        display: flex;
        flex-direction: row;
        padding: 0;
        margin: 0;
        overflow: hidden;
        background-color: #F8F8F2;
        justify-content: space-between;
        align-items: center;
      }
      #listNav {
        display: flex;
        flex-direction: row;
        padding: 0;
        margin: 0;
        list-style-type: none;
      }
      #listNav li a {
        display: block;
        color: #282A36;
        text-align: center;
        padding: .5em .8em;
        text-decoration: none;
      }
      #listNav li a:hover {
        background-color: #282A36;
        color: #50FA7B;
      }
      #listNav li.active a {
        background-color: #50FA7B;
      }
      #listNav li.active a:hover {
        color: #282A36;
        background-color: #50FA7B;
      }
      .nav-version {
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: row;
        align-items: center;
      }
      .logo_text {
        display: flex;
        flex-direction: column;
        color: #282A36;
        font-size: 13px;
        margin-right: 5px;
        text-align: right;
      }
      .nav-version a {
        color: #282A36;
        text-decoration: none;
      }

      .syn-func {
        color: #50FA7B;
      }
      .syn-type {
        color: #6272A4;
      }
      .syn-kw {
        color: #FFB86C;
      }
      .syn-tag {
        color: #FF79C6;
      }

      .markdown code {
        color: #FFB86C;
      }
      .markdown em {
        color: #50FA7B;
      }

      .tag-help {
        text-decoration: none;
        color: #F8F8F2;
      }

      .param-link {
        opacity: 0.0;
      }

      .param-link:hover {
        opacity: 1.0;
      }

      .func-source {
        display: flex;
        flex-direction: row;
        font-size: 0.8em;
      }

      .func-source div {
        padding-bottom: 10px;
        color: #6272A4;
      }

      .forgeSelected {
        background-color: #50FA7B;
        color: #282A36;
      }

      dd {
        padding-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="wrapper" id="wrapper" style="display:none">
      <div id="sectNav">
        <ul id="listNav"></ul>
        <span id="navVer" class="nav-version"></span>
      </div>
      <div id="sectModules">
        <h2>Modules</h1>
        <ul id="listModules" class="columns"></ul>
      </div>
      <div id="sectObjects">
        <h2>Objects</h1>
        <ul id="listObjects" class="columns"></ul>
      </div>
      <div id="sectFunctions">
        <h2>Functions</h1>
        <ul id="listFunctions" class="columns"></ul>
      </div>
      <div id="sectFunction">
        <h2>Function</h1>
        <pre><code id="funcProto"></code></pre>
        <div class="func-source">
          <div id="funcSource"></div>
        </div>

        <div id="funcDesc" class="markdown"></div>

        <div id="sectFunctionParams">
          <h2>Parameters</h1>
          <dl id="listFunctionParams"></dl>
        </div>
      </div>
      <div id="sectHelp">
        <h2>Help</h2>

        <h4>Forge links</h4>
        <a onclick="forgeSet('gh')" id='forgeSet_gh'>github</a>
        <a onclick="forgeSet('srht')" id='forgeSet_srht'>sourcehut</a>

        <h4>Tags</h4>
        <ul>
          <li>
            <span class="syn-tag">s</span>
            - indicates the tagged element is only available in
            <a href="https://docs.muon.build/scripting.html">scripting mode</a>
          </li>
          <li>
            <span class="syn-tag">e</span>
            - indicates the tagged element is a muon-specific extension
          </li>
        </ul>

        <h4>Attribution</h4>
        <ul>
          <li>
            Documentation sourced from <a href="https://mesonbuild.com">the meson project</a> and <a href="https://muon.build">muon</a>.
          </li>
          <li>
            Meson is a registered trademark of Jussi Pakkanen.
          </li>
          <li>
            Documentation
            <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" height=16></img>
            <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" height=16></img>
            <img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg" height=16></img>
          </li>
          <li>
            Code samples
            <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" height=16></img>
            <img src="https://mirrors.creativecommons.org/presskit/icons/zero.svg" height=16></img>
          </li>
        </ul>
      </div>
    </div>

    <script type="application/json" id="data_external">%s</script>
    <script type="application/json" id="data_internal">%s</script>
    <script type="application/json" id="version">%s</script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      let dataExternal = JSON.parse(document.getElementById("data_external").innerHTML);
      let dataInternal = JSON.parse(document.getElementById("data_internal").innerHTML);
      let version = JSON.parse(document.getElementById("version").innerHTML);
      let forge = '';

      const funcKey = (f) => `${f.rcvr}${f.module}${f.name}`;
      let map = {};
      let data = [];
      for (const f of dataExternal) {
        map[funcKey(f)] = f;
        f.modes = {external: true};
        data.push(f);
      }
      for (const f of dataInternal) {
        const key = funcKey(f);
        if (key in map) {
          map[key].modes.internal = true;
        } else {
          f.modes = {internal: true};
          data.push(f);
        }
      }

      function forgeSet(newForge, skipRender) {
        if (forge !== '') {
          document.getElementById(`forgeSet_${forge}`).classList.remove('forgeSelected');
        }
        document.getElementById(`forgeSet_${newForge}`).classList.add('forgeSelected');
        forge = newForge;
        if (!skipRender) {
          render();
        }
      }
      forgeSet('srht', true);

      function forgeUrlCommit() {
        if (forge === 'srht') {
          return `https://git.sr.ht/~lattis/muon/commit/${version.vcs_tag}`
        } else if (forge === 'gh') {
          return `https://github.com/muon-build/muon/commit/${version.vcs_tag}`
        }
      }

      function forgeUrlFile(path, line) {
        let lineSuffix = '';
        if (line) {
          lineSuffix = `#L${line}`;
        }

        if (forge === 'srht') {
          return `https://git.sr.ht/~lattis/muon/tree/${version.vcs_tag}/item/${path}${lineSuffix}`
        } else if (forge === 'gh') {
          return `https://github.com/muon-build/muon/blob/${version.vcs_tag}/${path}${lineSuffix}`
        }
      }

      function render() {
        document.title = `muon - docs`;

        let domNavVer = document.getElementById("navVer");
        let domListNav = document.getElementById("listNav");
        let domSectModules = document.getElementById("sectModules");
        let domListModules = document.getElementById("listModules");
        let domSectObjects = document.getElementById("sectObjects");
        let domListObjects = document.getElementById("listObjects");
        let domSectFunctions = document.getElementById("sectFunctions");
        let domListFunctions = document.getElementById("listFunctions");
        let domSectFunction = document.getElementById("sectFunction");
        let domFuncProto = document.getElementById("funcProto");
        let domFuncSource = document.getElementById("funcSource");
        let domFuncDesc = document.getElementById("funcDesc");
        let domSectFunctionParams = document.getElementById("sectFunctionParams");
        let domListFunctionParams = document.getElementById("listFunctionParams");
        let domSectHelp = document.getElementById("sectHelp");

        let scrollTarget = undefined;

        domSectModules.style.display = 'none';
        domSectObjects.style.display = 'none';
        domSectFunctions.style.display = 'none';
        domSectFunction.style.display = 'none';
        domSectHelp.style.display = 'none';
        document.getElementById('wrapper').style.display = 'block';

        let nav = decodeURIComponent(window.location.hash).split('.');
        let navRoot = nav.shift();
        let filter = {};

        if (navRoot === '#modules') {
          filter.mod = nav.shift();
        } else if (navRoot === '#objects') {
          filter.obj = nav.shift();
        } else if (navRoot === '#kernel') {
          filter.kernel = true;
        } else if (navRoot === '#help') {
          filter.help = true;
        } else {
          filter.kernel = true;
        }
        filter.func = nav.shift();
        filter.param = nav.shift();

        function buildFilterString(filter) {
          let str = '';
          if (filter.help) {
            str += `help`;
          } else {
            if (filter.mod) {
              str += `modules.${filter.mod}`;
            } else if (filter.obj) {
              str += `objects.${filter.obj}`;
            } else if (filter.kernel) {
              str += `kernel`;
            }

            if (filter.func) {
              str += `.${filter.func}`;
            }

            if (filter.param) {
              str += `.${filter.param}`;
            }
          }

          return '#' + encodeURIComponent(str);
        }

        function link(href, html) {
          let a = document.createElement("a");
          a.innerHTML = html;
          a.setAttribute("href", `#${href}`);
          return a;
        }

        function escapeHtml(s) {
          return s.replaceAll('&', '&amp;')
                  .replaceAll('<', '&lt;')
                  .replaceAll('>', '&gt;')
                  .replaceAll('"', '&quot;')
                  .replaceAll("'", '&#039;');
        }

        function buildNav() {
          let navList = [];
          function pushNav(href, name) {
            let li = document.createElement("li");
            li.appendChild(link(href, name));
            navList.push(li);
          }

          let path = 'kernel';
          pushNav("help", "?");
          pushNav("kernel", "kernel");
          if (filter.mod) {
            path = `modules.${filter.mod}`;
            pushNav(path, "modules");
            pushNav(path, `${filter.mod}`);
          } else if (filter.obj) {
            path = `objects.${filter.obj}`;
            pushNav(path, "objects");
            pushNav(path, `${filter.obj}`);
          }

          if (filter.func) {
            pushNav(`${path}.${filter.func}`, filter.func);
          }

          if (filter.help) {
            navList[0].classList.add('active');
          } else {
            navList[navList.length - 1].classList.add('active');
          }

          domListNav.replaceChildren();
          for (li of navList) {
            domListNav.appendChild(li);
          }

          domNavVer.replaceChildren();

          verText = document.createElement("div");
          verText.classList.add("logo_text");

          verTitle = document.createElement("span");
          verTitle.innerHTML = version.version;
          verText.appendChild(verTitle);

          verVer = document.createElement("a");
          verVer.innerHTML = `${version.vcs_tag}`;
          verVer.setAttribute("href", forgeUrlCommit());
          verText.appendChild(verVer);
          domNavVer.appendChild(verText);

          verLink = document.createElement("a");
          verLink.setAttribute("href", "https://muon.build");
          verLogo = document.createElement("img");
          verLogo.setAttribute("src", "https://muon.build/muon_logo.svg");
          verLogo.setAttribute("height", "28");
          verLink.appendChild(verLogo);
          domNavVer.appendChild(verLink);
        }
        buildNav();

        if (filter.help) {
          domSectHelp.style.display = 'block';
          return;
        }

        function filteredFuncs() {
          let funcs = [];

          for (let f of data) {
            if (filter.kernel) {
              if ('rcvr' in f || 'module' in f) {
                continue;
              }
            } else if (filter.obj) {
              if (f.rcvr !== filter.obj) {
                continue;
              }
            } else if (filter.mod) {
              if (f.module !== filter.mod) {
                continue;
              }
            }

            funcs.push(f);
          }

          funcs.sort((a, b) => {
            return a.name < b.name ? -1 : 1;
          });

          return funcs;
        }

        function synNode(syn, txt) {
          let e = document.createElement("span");
          e.classList.add(`syn-${syn}`);

          if (syn === 'type') {
            txt = txt.split('|');
            txt = txt.join(' | ');
          }

          e.innerHTML = txt;
          return e;
        }

        function synFunc(txt) {
          return synNode('func', txt);
        }
        function synType(txt) {
          return synNode('type', txt);
        }
        function synKw(txt) {
          return synNode('kw', escapeHtml(txt));
        }
        function synPunc(txt) {
          return synNode('punc', txt);
        }
        function synTag(tags, props={}) {
          let e = document.createElement("span");

          if (!props.no_indent) {
            e.appendChild(synPunc(' '));
          }

          let a = document.createElement("a");
          a.setAttribute("href", `#help`);
          a.classList.add('tag-help');
          a.appendChild(synPunc('['));
          a.appendChild(synNode('tag', tags));
          a.appendChild(synPunc(']'));
          e.appendChild(a);

          return e;
        }

        function funcTags(f) {
          let tags = '';
          if ('internal' in f.modes && !('external' in f.modes)) {
            tags += 's';
          }

          if (f.extension) {
            tags += 'e';
          }

          return tags;
        }

        function funcProto(e, f) {
          let params = [];

          let argc = (f.posargs ? f.posargs.length : 0) + (f.kwargs ? f.kwargs.length : 0);
          let explode = argc > 4;

          function pushBreak() {
              if (explode) { e.insertAdjacentText('beforeend', '\n'); }
          }
          function pushIndent() {
              if (explode) { e.insertAdjacentText('beforeend', "    "); }
          }

          e.appendChild(synFunc(f.name));

          const tags = funcTags(f);
          if (tags) {
            e.appendChild(synTag(tags, {no_indent:true}));
          }

          e.appendChild(synPunc('('));
          pushBreak();

          if (f.posargs && f.posargs.length > 0) {
            for (let [i, p] of f.posargs.entries()) {
              pushIndent();
              let a = document.createElement('a');
              a.setAttribute("href", buildFilterString({...filter, param: p.name}));
              a.appendChild(synType(p.type));
              e.appendChild(a);
              if (explode || i < f.posargs.length - 1) {
                e.appendChild(synPunc(', '));
              }
              pushBreak();
            }

            if (!explode && f.kwargs) {
                e.appendChild(synPunc(', '));
            }
          }

          if (f.kwargs) {
            for (let [i, p] of f.kwargs.entries()) {
              pushIndent();

              let a = document.createElement('a');
              a.setAttribute("href", buildFilterString({...filter, param: p.name}));
              a.appendChild(synKw(p.name));
              e.appendChild(a);

              if (p.extension) {
                e.appendChild(synTag('e', {no_indent: true}));
              }
              e.appendChild(synPunc(': '));
              e.appendChild(synType(p.type));
              if (explode || i < f.kwargs.length - 1) {
                e.appendChild(synPunc(', '));
              }
              pushBreak();
            }
          }

          e.appendChild(synPunc(')'));
          e.appendChild(synPunc(' -> '));
          e.appendChild(synType(f.type));

          return e;
        }

        if (filter.func) {
          let func = undefined;
          for (let f of filteredFuncs()) {
            if (f.name === filter.func) {
              func = f;
              break;
            }
          }

          function buildFunction() {
            domSectFunction.style.display = 'block';
            domFuncProto.replaceChildren();

            if (func === undefined) {
              domFuncDesc.innerHTML = 'unknown function';
              return;
            }

            domFuncSource.replaceChildren();
            if (func.source_file) {
              let a = document.createElement('a');
              let url = forgeUrlFile(func.source_file, func.source_line);
              a.setAttribute("href", url);
              a.innerHTML = `${func.source_file}:${func.source_line}`;
              domFuncSource.appendChild(a);
            }

            funcProto(domFuncProto, func);

            if (func.desc) {
              domFuncDesc.innerHTML = marked.parse(func.desc);
            } else {
              domFuncDesc.innerHTML = '';
            }

            domSectFunctionParams.style.display = 'none';
            domListFunctionParams.replaceChildren();

            function pushArg(p, isKwarg) {
              // Title

              let e = document.createElement('dt');
              let a = document.createElement('a');
              a.innerHTML = '#';
              a.setAttribute("href", buildFilterString({...filter, param: p.name}));
              e.appendChild(a);

              if (filter.param === p.name) {
                scrollTarget = e;
              } else {
                a.classList.add('param-link');
              }

              if (isKwarg) {
                e.appendChild(synKw(p.name));
                if (p.extension) {
                  e.appendChild(synTag('e', {no_indent: true}));
                }
                e.appendChild(synPunc(': '));
              }
              e.appendChild(synType(p.type));

              domListFunctionParams.appendChild(e);

              // Description

              e = document.createElement('dd');
              div = document.createElement('div');
              div.classList.add("markdown");
              if (p.desc) {
                div.innerHTML = marked.parse(p.desc);
              }
              e.appendChild(div);
              domListFunctionParams.appendChild(e);

              domSectFunctionParams.style.display = 'block';
            }

            if (func.posargs) {
              for (let p of func.posargs) {
                pushArg(p, false);
              }
            }

            if (func.kwargs) {
              for (let p of func.kwargs) {
                pushArg(p, true);
              }
            }
          }
          buildFunction();
        } else {
          if (filter.kernel) {
            function buildModules() {
              domSectModules.style.display = 'block';
              domListModules.replaceChildren();

              let modules = {};
              for (let f of data) {
                if ('module' in f) {
                  const parts = f.module.split('/');
                  modules[parts[1]] = parts[0];
                }
              }

              for (let m of Object.keys(modules).sort()) {
                let li = document.createElement("li");
                li.appendChild(link(`modules.${modules[m]}/${m}`, m));
                if (modules[m] === 'private') {
                  li.appendChild(synTag('s'));
                }
                domListModules.appendChild(li);
              }
            }
            buildModules();
          }

          if (filter.kernel) {
            function buildObjects() {
              domSectObjects.style.display = 'block';
              domListObjects.replaceChildren();

              let objects = {};
              for (let f of data) {
                if ('rcvr' in f) {
                  objects[f.rcvr] = true;
                }
              }

              for (let o of Object.keys(objects).sort()) {
                let li = document.createElement("li");
                li.appendChild(link(`objects.${o}`, o));
                domListObjects.appendChild(li);
              }
            }
            buildObjects();
          }

          function buildFunctions() {
            domSectFunctions.style.display = 'block';
            domListFunctions.replaceChildren();

            for (let f of filteredFuncs()) {
              let li = document.createElement("li");

              let path;
              if ('rcvr' in f) {
                path = `objects.${f.rcvr}`;
              } else if ('module' in f) {
                path = `modules.${f.module}`;
              } else {
                path = `kernel`;
              }

              li.appendChild(link(`${path}.${f.name}`, f.name));

              const tags = funcTags(f);
              if (tags) {
                li.appendChild(synTag(tags));
              }
              domListFunctions.appendChild(li);
            }
          }
          buildFunctions();
        }

        if (scrollTarget) {
          scrollTarget.scrollIntoView(true);
        } else {
          window.scrollTo(0, 0);
        }
      }
      render();

      addEventListener("hashchange", (event) => {
        render();
      });
    </script>
  </body>
</html>
